<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nuces Stack</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="/css/global.css">
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="/css/admin.css">
    <script>

    </script>
</head>

<body class="font-body bg-primary antialiased">
    <div class="relative flex min-h-screen flex-col">
        <!-- Header -->
        <header
            class="sticky top-0 z-50 w-full border-b border-gray-300 color-primary bg-primary backdrop-blur">
            <div class="container mx-auto flex h-14 items-center px-4">
                <a class="flex items-center gap-2 font-bold text-lg mr-6" href="/">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 color-primary" fill="none"
                        viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path d="M2 16V4a2 2 0 0 1 2-2h11"></path>
                        <path
                            d="M22 18H11a2 2 0 1 0 0 4h10.5a.5.5 0 0 0 .5-.5v-15a.5.5 0 0 0-.5-.5H11a2 2 0 0 0-2 2v12">
                        </path>
                        <path d="M5 14H4a2 2 0 1 0 0 4h1"></path>
                    </svg>
                    <span class="font-headline">Nuces Stack</span>
                </a>
                <div class="flex flex-1 items-center justify-end">
                    <nav class="flex items-center">
                        <button id="mobileMenuBtn" class="lg:hidden p-2 rounded-lg hover:bg-primary transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 color-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                            </svg>
                        </button>
                    </nav>
                </div>
            </div>
        </header>


    <!-- Added mobile sidebar overlay -->
    <div id="sidebarOverlay" class="sidebar-overlay lg:hidden"></div>

    <!-- Converted horizontal tabs to sidebar layout -->
    <div class="flex min-h-screen">
        <!-- Sidebar Navigation -->
        <nav id="sidebar" class="fixed lg:static inset-y-0 left-0 z-40 w-64 bg-white border-r border-color-primary/20 shadow-sm mobile-sidebar lg:transform-none">
            <div class="p-4 sm:p-6">
                <!-- Added mobile close button -->
                <div class="flex items-center justify-between mb-6 lg:hidden">
                    <h2 class="text-lg font-semibold color-primary">Menu</h2>
                    <button id="closeSidebarBtn" class="p-2 rounded-lg hover:bg-primary transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 color-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                
                <div class="space-y-2">
                    <button class="tab-button w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left hover:bg-primary transition-colors active bg-color-primary text-white" data-tab="overview">
                        <i data-lucide="chart-pie" class="w-6 h-6"></i>
                        <span class="font-medium">Overview</span>
                    </button>
                    <button class="tab-button w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left hover:bg-primary transition-colors text-gray-600" data-tab="subjects">
                         <i data-lucide="book" class="w-6 h-6"></i>
                        <span class="font-medium">Subjects</span>
                    </button>
                    <button class="tab-button w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left hover:bg-primary transition-colors text-gray-600" data-tab="notes">
                        <i class="w-6 h-6" data-lucide="notebook-pen"></i>
                        <span class="font-medium">Notes</span>
                    </button>
                    <button class="tab-button w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left hover:bg-primary transition-colors text-gray-600" data-tab="approve">
                        <i class="w-6 h-6" data-lucide="list-check"></i>
                        <span class="font-medium">Approve Notes</span>
                    </button>
                    <form action="/logout" method="POST" class="w-full">
                        <button type="submit" class="tab-button w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left hover:bg-primary transition-colors text-gray-600">
                            <i class="w-6 h-6 text-red-600" data-lucide="log-out"></i>
                            <span class="font-medium">Logout</span>
                        </button>
                    </form>

                </div>
            </div>
        </nav>

        <!-- Main Content Area -->
        <main class="flex-1 p-4 sm:p-6 lg:p-8 lg:ml-0">
            <!-- Semester Selector (Always visible) -->
            <div id="semSelect" class="bg-white rounded-xl border border-color-primary/20 shadow-sm p-4 sm:p-6 mb-4 sm:mb-6">
                <div class="flex items-center gap-3 mb-4">
                    <div class="h-8 w-8 sm:h-10 sm:w-10 rounded-xl bg-primary flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 color-primary" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 0 1 2 2v14l-4-3-4 3V5a2 2 0 0 1 2-2Z"/>
                        </svg>
                    </div>
                    <h3 class="text-base sm:text-lg font-semibold color-primary">Select Semester</h3>
                </div>
                
                <label class="block text-sm mb-2 text-gray-700">Current Semester</label>
                <select id="semesterSelect" class="w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-color-primary/50 focus:border-color-primary">
                    <option value="">Loading semesters...</option>
                </select>
            </div>

            <!-- Overview Tab Content -->
            <div id="overview" class="tab-content active">
                <!-- Made stats cards fully responsive -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 mb-6 sm:mb-8">
                    <!-- Stats Cards -->
                    <div class="bg-white rounded-xl border border-color-primary/20 shadow-sm p-4 sm:p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs sm:text-sm text-gray-600">Total Subjects</p>
                                <p class="text-xl sm:text-2xl font-bold color-primary" id="totalSubjects">0</p>
                            </div>
                            <div class="h-10 w-10 sm:h-12 sm:w-12 rounded-xl bg-primary flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6 color-primary" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6" d="m12 14 9-5-9-5-9 5 9 5Z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6" d="M19 10v6a7 7 0 0 1-14 0v-6"/>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl border border-color-primary/20 shadow-sm p-4 sm:p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs sm:text-sm text-gray-600">Total Notes</p>
                                <p class="text-xl sm:text-2xl font-bold color-primary" id="totalNotes">0</p>
                            </div>
                            <div class="h-10 w-10 sm:h-12 sm:w-12 rounded-xl bg-primary flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6 color-primary" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6" d="M9 12h6m-6 4h6M8 3h8a2 2 0 0 1 2 2v14l-4-3-4 3V5a2 2 0 0 1 2-2Z"/>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl border border-color-primary/20 shadow-sm p-4 sm:p-6 sm:col-span-2 lg:col-span-1">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs sm:text-sm text-gray-600">Active Semester</p>
                                <p class="text-base sm:text-lg font-semibold color-primary" id="activeSemester">-</p>
                            </div>
                            <div class="h-10 w-10 sm:h-12 sm:w-12 rounded-xl bg-primary flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6 color-primary" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 0 1 2 2v14l-4-3-4 3V5a2 2 0 0 1 2-2Z"/>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="bg-white rounded-xl border border-color-primary/20 shadow-sm p-4 sm:p-6">
                    <h3 class="text-base sm:text-lg font-semibold color-primary mb-4">Recent Activity</h3>
                    <div class="space-y-3" id="recentActivity">
                        <p class="text-gray-500 text-center py-6 sm:py-8 text-sm sm:text-base">No recent activity</p>
                    </div>
                </div>
            </div>

            <!-- Approve Notes Tab Content -->
             <div id="approve" class="tab-content">
                <div class="bg-white rounded-xl border border-color-primary/20 shadow-sm p-4 sm:p-6">
                    <h3 class="text-base sm:text-lg lg:text-2xl font-semibold color-primary mb-4">Pending Notes for Approval</h3>
                         <div id="pendingNotesList" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 mb-6 sm:mb-8">
                             <p class="text-gray-500 text-center py-6 sm:py-8 text-sm sm:text-base">Loading pending notes...</p>
                         </div>
                </div>
             </div>

            <!-- Subjects Tab Content -->
            <div id="subjects" class="tab-content">
                <!-- Made subjects section responsive -->
                <div class="grid grid-cols-1 xl:grid-cols-2 gap-4 sm:gap-6">
                    <!-- Add Subject -->
                    <div class="bg-white rounded-xl border border-color-primary/20 shadow-sm p-4 sm:p-6">
                        <div class="flex items-center gap-3 mb-4 sm:mb-6">
                            <div class="h-8 w-8 sm:h-10 sm:w-10 rounded-xl bg-primary flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 color-primary" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6" d="m12 14 9-5-9-5-9 5 9 5Z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6" d="M19 10v6a7 7 0 0 1-14 0v-6"/>
                                </svg>
                            </div>
                            <h3 class="text-base sm:text-lg font-semibold color-primary">Add Subject</h3>
                        </div>

                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Subject Name</label>
                                <input id="subjectName" type="text"
                                       class="w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-color-primary/50 focus:border-color-primary"
                                       placeholder="" />
                            </div>
                            <button id="addSubjectBtn"
                                    class="w-full py-2 sm:py-3 text-sm sm:text-base rounded-lg bg-color-primary hover:bg-color-light-primary text-white font-medium transition-colors">
                                <span class="btn-text">Add Subject</span>
                                <div class="loading-spinner" style="display: none;"></div>
                            </button>
                        </div>
                    </div>

                    <!-- Subjects List -->
                    <div class="bg-white rounded-xl border border-color-primary/20 shadow-sm p-4 sm:p-6">
                        <div class="flex items-center gap-3 mb-4 sm:mb-6">
                            <div class="h-8 w-8 sm:h-10 sm:w-10 rounded-xl bg-primary flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 color-primary" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6" d="M8 6h13M8 12h13M8 18h13M3 6h.01M3 12h.01M3 18h.01"/>
                                </svg>
                            </div>
                            <h3 class="text-base sm:text-lg font-semibold color-primary">Subjects</h3>
                        </div>

                        <ul id="subjectList" class="space-y-3">
                            <!-- Subject items will be injected here -->
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Notes Tab Content -->
            <div id="notes" class="tab-content">
                <!-- Made notes section responsive -->
                <div class="grid grid-cols-1 xl:grid-cols-2 gap-4 sm:gap-6">
                    <!-- Add Note -->
                    <div class="bg-white rounded-xl border border-color-primary/20 shadow-sm p-4 sm:p-6">
                        <div class="flex items-center gap-3 mb-4 sm:mb-6">
                            <div class="h-8 w-8 sm:h-10 sm:w-10 rounded-xl bg-primary flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 color-primary" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6" d="M9 12h6m-6 4h6M8 3h8a2 2 0 0 1 2 2v14l-4-3-4 3V5a2 2 0 0 1 2-2Z"/>
                                </svg>
                            </div>
                            <h3 class="text-base sm:text-lg font-semibold color-primary">Add Note</h3>
                        </div>

                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Subject</label>
                                <select id="noteSubject" class="w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-color-primary/50 focus:border-color-primary">
                                    <!-- Options will be injected -->
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Note Title</label>
                                <input id="noteTitle" type="text"
                                       class="w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-color-primary/50 focus:border-color-primary"
                                       placeholder="" />
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Description (Optional)</label>
                                <textarea id="noteDescription" rows="3"
                                          class="w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-color-primary/50 focus:border-color-primary"
                                          placeholder="Brief description of the note"></textarea>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">PDF ID/Link</label>
                                <input id="notePdfId" type="text"
                                       class="w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-color-primary/50 focus:border-color-primary"
                                       placeholder="Google Drive Link to PDF" />
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Video ID/Link</label>
                                <input id="noteVideoId" type="text"
                                       class="w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-color-primary/50 focus:border-color-primary"
                                       placeholder="YouTube Video link" />
                            </div>

                            <button id="addNoteBtn"
                                    class="w-full py-2 sm:py-3 text-sm sm:text-base rounded-lg bg-color-primary hover:bg-color-light-primary text-white font-medium transition-colors">
                                <span class="btn-text">Add Note</span>
                                <div class="loading-spinner" style="display: none;"></div>
                            </button>
                        </div>
                    </div>

                    <!-- Remove Note -->
                    <div class="bg-white rounded-xl border border-color-primary/20 shadow-sm p-4 sm:p-6">
                        <div class="flex items-center gap-3 mb-4 sm:mb-6">
                            <div class="h-8 w-8 sm:h-10 sm:w-10 rounded-xl bg-primary flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 color-primary" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6" d="M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M6 6l1 14a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2l1-14"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6" d="M10 11v6M14 11v6"/>
                                </svg>
                            </div>
                            <h3 class="text-base sm:text-lg font-semibold color-primary">Remove Note</h3>
                        </div>

                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Subject</label>
                                <select id="removeNoteSubject" class="w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-color-primary/50 focus:border-color-primary"></select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Note</label>
                                <select id="removeNoteSelect" class="w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-color-primary/50 focus:border-color-primary"></select>
                            </div>

                            <button id="removeNoteBtn"
                                    class="w-full py-2 sm:py-3 text-sm sm:text-base rounded-lg bg-color-primary hover:bg-color-light-primary text-white font-medium transition-colors">
                                <span class="btn-text">Remove Note</span>
                                <div class="loading-spinner" style="display: none;"></div>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-4 sm:bottom-6 left-1/2 -translate-x-1/2 hidden z-50 mx-4">
        <div class="px-4 sm:px-6 py-3 rounded-xl bg-white shadow-lg border border-color-primary/20 color-primary text-sm font-medium max-w-sm text-center"></div>
    </div>

    <script src="/js/admin-panel.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const closeSidebarBtn = document.getElementById('closeSidebarBtn');
            const sidebar = document.getElementById('sidebar');
            const sidebarOverlay = document.getElementById('sidebarOverlay');

            // Mobile menu toggle
            mobileMenuBtn.addEventListener('click', () => {
                sidebar.classList.add('active');
                sidebarOverlay.classList.add('active');
                document.body.style.overflow = 'hidden';
            });

            // Close sidebar
            function closeSidebar() {
                sidebar.classList.remove('active');
                sidebarOverlay.classList.remove('active');
                document.body.style.overflow = '';
            }

            closeSidebarBtn.addEventListener('click', closeSidebar);
            sidebarOverlay.addEventListener('click', closeSidebar);

            // Close sidebar when tab is clicked on mobile
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const targetTab = button.getAttribute('data-tab');
                    
                    // Remove active classes from all buttons
                    tabButtons.forEach(btn => {
                        btn.classList.remove('bg-color-primary', 'text-white');
                        btn.classList.add('text-gray-600');
                    });
                    
                    // Hide all tab contents
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // Add active classes to clicked button
                    button.classList.add('bg-color-primary', 'text-white');
                    button.classList.remove('text-gray-600');
                    
                    // Show corresponding content
                    document.getElementById(targetTab).classList.add('active');

                    // Close sidebar on mobile after tab selection
                    if (window.innerWidth < 1024) {
                        closeSidebar();
                    }
                });
            });

            const overviewButton = document.querySelector('[data-tab="overview"]');
            overviewButton.classList.add('bg-color-primary', 'text-white');
            overviewButton.classList.remove('text-gray-600');

            window.addEventListener('resize', () => {
                if (window.innerWidth >= 1024) {
                    closeSidebar();
                }
            });

        });

        document.addEventListener('DOMContentLoaded', async function() {
                
            if (document.getElementById('pendingNotesList')) {
                const notes = await fetchPendingNotes();
                renderPendingNotes(notes.notes);
            }
            
        });
    </script>



    <%- include('partials/footer') %>